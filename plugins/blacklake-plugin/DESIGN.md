# Blacklake Plugin è®¾è®¡æ–‡æ¡£

## ä¸€ã€è®¾è®¡ç†å¿µ

### 1.1 å®šä½

**Blacklake Plugin** æ˜¯å…¬å¸å†…éƒ¨è¿ç»´è¾…åŠ©å·¥å…·æ’ä»¶ï¼Œä¸“æ³¨äºï¼š
- ğŸ” **å·¥ä½œæµé—®é¢˜æ’æŸ¥å’Œè¯Šæ–­**ï¼šå¿«é€Ÿå®šä½å·¥ä½œæµæ‰§è¡Œé—®é¢˜
- âš™ï¸ **è¿æ¥å™¨é…ç½®ç®¡ç†**ï¼šç”Ÿæˆå’Œç®¡ç† API è¿æ¥å™¨é…ç½®
- ğŸ“Š **å¹³å°æ•°æ®ç»Ÿè®¡åˆ†æ**ï¼šå¤šç»´åº¦æ•°æ®åˆ†æ
- ğŸ—„ï¸ **æ•°æ®åº“æŸ¥è¯¢å’Œæ“ä½œ**ï¼šæä¾›æ ‡å‡†åŒ–çš„æ•°æ®åº“æŸ¥è¯¢èƒ½åŠ›

### 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

åŸºäº [Claude Code å®˜æ–¹æ–‡æ¡£](https://claude.com/blog/skills-explained) çš„æœ€ä½³å®è·µï¼š

#### åŸåˆ™1ï¼šåˆ†å±‚æ¶æ„ï¼ˆAgent â†’ Skills â†’ MCP Toolsï¼‰

```
User Request
    â†“
Agent (ä¸šåŠ¡é€»è¾‘ç¼–æ’)
    â†“
Skills (ç¨‹åºæ€§çŸ¥è¯†)
    â†“
MCP Tools (æ‰§è¡Œ)
```

**èŒè´£åˆ’åˆ†**ï¼š
- **Agent å±‚**ï¼šä¸šåŠ¡é€»è¾‘ç¼–æ’è€…ï¼Œä¸“æ³¨äºç‰¹å®šè¿ç»´åœºæ™¯
- **Skill å±‚**ï¼šç¨‹åºæ€§çŸ¥è¯†æä¾›è€…ï¼Œæ•™ Claude "å¦‚ä½•åš"
- **MCP Tools å±‚**ï¼šæ‰§è¡Œè€…ï¼Œæ‰§è¡Œå…·ä½“çš„æ“ä½œ

#### åŸåˆ™2ï¼šSkills æä¾›ç¨‹åºæ€§çŸ¥è¯†

æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼ŒSkills åº”è¯¥æä¾›ï¼š
- âœ… **ç¨‹åºæ€§çŸ¥è¯†**ï¼ˆProcedural knowledgeï¼‰ï¼šå¦‚ä½•æ‰§è¡Œä»»åŠ¡
- âœ… **å·¥ä½œæµç¨‹**ï¼šæ­¥éª¤åŒ–çš„æ‰§è¡ŒæŒ‡å—
- âœ… **æŸ¥è¯¢æ¨¡æ¿**ï¼šå¯å¤ç”¨çš„ SQL æ¨¡æ¿
- âœ… **æœ€ä½³å®è·µ**ï¼šä¸“ä¸šé¢†åŸŸçš„ç»éªŒæ€»ç»“

#### åŸåˆ™3ï¼šSkills è‡ªåŠ¨å‘ç°æœºåˆ¶

**å®˜æ–¹æœºåˆ¶**ï¼š
- Skills å­˜å‚¨åœ¨ `.claude/skills/` æˆ–é¡¹ç›®çš„ `skills/` ç›®å½•
- Claude **è‡ªåŠ¨å‘ç°**å’Œ**åŠ¨æ€åŠ è½½** Skills
- ä½¿ç”¨**æ¸è¿›å¼æŠ«éœ²**ï¼š
  - å…ƒæ•°æ®å…ˆåŠ è½½ï¼ˆ~100 tokensï¼‰
  - å®Œæ•´æŒ‡ä»¤æŒ‰éœ€åŠ è½½ï¼ˆ<5k tokensï¼‰
  - æ–‡ä»¶å’Œè„šæœ¬æŒ‰éœ€åŠ è½½

**Agent ä¸ Skills çš„å…³ç³»**ï¼š
- âœ… Agent åœ¨æ–‡æ¡£ä¸­**è¯´æ˜**ç›¸å…³ Skills
- âœ… Claude **è‡ªåŠ¨å‘ç°**å¹¶ä½¿ç”¨ç›¸å…³ Skills
- âŒ **ä¸éœ€è¦**åœ¨ frontmatter ä¸­æ˜¾å¼é…ç½®
- âŒ **ä¸éœ€è¦**Agent æ˜¾å¼è°ƒç”¨ Skills

#### åŸåˆ™4ï¼šSkills è‡ªåŒ…å«åŸåˆ™

**å®˜æ–¹å»ºè®®**ï¼š
- âœ… æ¯ä¸ª Skill åº”è¯¥æ˜¯ç‹¬ç«‹çš„ã€è‡ªåŒ…å«çš„æ¨¡å—
- âœ… Skill æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶åº”æ”¾åœ¨æŠ€èƒ½ç›®å½•å†…
- âœ… ä¿æŒä½è€¦åˆï¼Œæé«˜å¯ç§»æ¤æ€§

**å®ç°æ–¹å¼**ï¼š
- ä½¿ç”¨ç¬¦å·é“¾æ¥ä¿æŒ `COMMON.md` çš„ä¸€è‡´æ€§
- æ¯ä¸ª Skill ç›®å½•åŒ…å«å®Œæ•´çš„èµ„æº
- é¿å…è·¨ç›®å½•çš„ç›´æ¥ä¾èµ–

## äºŒã€æ¶æ„è®¾è®¡

### 2.1 ç»„ä»¶å…³ç³»

```mermaid
graph TB
    User[ç”¨æˆ·è¯·æ±‚] --> Agent[Agent/Subagent]
    Agent -->|è‡ªåŠ¨å‘ç°| Skill1[db-common Skill]
    Agent -->|è‡ªåŠ¨å‘ç°| Skill2[db-metadata Skill]
    Agent -->|è‡ªåŠ¨å‘ç°| Skill3[db-openapi Skill]
    Skill1 -->|ä½¿ç”¨| MCP[MCP Tools]
    Skill2 -->|ä½¿ç”¨| MCP
    Skill3 -->|ä½¿ç”¨| MCP
    MCP -->|æ‰§è¡Œ| DB[(æ•°æ®åº“)]
    
    Common[common/COMMON.md] -.->|ç¬¦å·é“¾æ¥| Skill1
    Common -.->|ç¬¦å·é“¾æ¥| Skill2
    Common -.->|ç¬¦å·é“¾æ¥| Skill3
```

### 2.2 æ•°æ®æµ

```
ç”¨æˆ·è¯·æ±‚
  â†“
Agent ç†è§£ä»»åŠ¡
  â†“
Claude è‡ªåŠ¨å‘ç°ç›¸å…³ Skills
  â†“
åŠ è½½ Skills çš„ç¨‹åºæ€§çŸ¥è¯†ï¼ˆå·¥ä½œæµç¨‹ã€æ¨¡æ¿ï¼‰
  â†“
Agent ä½¿ç”¨ Skills ä¸­çš„æ–¹æ³•æ‰§è¡Œä»»åŠ¡
  â†“
è°ƒç”¨ MCP Tools æ‰§è¡Œå…·ä½“æ“ä½œ
  â†“
è¿”å›ç»“æœç»™ Agent
  â†“
Agent æ•´åˆç»“æœå¹¶è¾“å‡º
```

## ä¸‰ã€Skills è®¾è®¡

### 3.1 Skills åˆ—è¡¨

| Skill | æ•°æ®åº“ | ä¸»è¦åŠŸèƒ½ |
|-------|--------|---------|
| db-common | é€šç”¨ | æŸ¥è¯¢å·¥ä½œæµç¨‹ã€SQL æ¨¡æ¿ã€ç»“æœåˆ†æ |
| db-user | v3_user | ç§Ÿæˆ·å’Œç»„ç»‡ä¿¡æ¯æŸ¥è¯¢ |
| db-openapi | v3_openapi | è¿æ¥å™¨å’Œ API é…ç½®æŸ¥è¯¢ |
| db-metadata | v3_metadata | å¯¹è±¡ç¼–ç ã€æŒ‰é’®ã€äº‹ä»¶é…ç½®æŸ¥è¯¢ |
| db-e-report | v3_e-report | æ•°æ®åˆ†æå‘Šè­¦é…ç½®æŸ¥è¯¢ |

### 3.2 Skills ç»“æ„

æ¯ä¸ª Skill åŒ…å«ï¼š
- `SKILL.md` - æŠ€èƒ½å®šä¹‰æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
- `COMMON.md` - é€šç”¨è§„èŒƒï¼ˆç¬¦å·é“¾æ¥åˆ° `common/COMMON.md`ï¼‰

**SKILL.md æ ‡å‡†ç»“æ„**ï¼š
```markdown
---
name: db-common
description: ...
---

# æŠ€èƒ½åç§°

## ã€é€šç”¨è§„èŒƒã€‘
å‚è€ƒï¼š[é€šç”¨è§„èŒƒ](./COMMON.md)

## ã€æŸ¥è¯¢å·¥ä½œæµç¨‹ã€‘
1. ç¡®å®šæŸ¥è¯¢ç›®æ ‡
2. é€‰æ‹©æŸ¥è¯¢æ–¹æ³•
3. æ‰§è¡ŒæŸ¥è¯¢
4. ç»“æœåˆ†æ

## æŸ¥è¯¢æ¨¡æ¿
...
```

### 3.3 COMMON.md ç®¡ç†

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨ç¬¦å·é“¾æ¥ä¿æŒä¸€è‡´æ€§

```bash
# åˆ›å»ºç¬¦å·é“¾æ¥
cd skills/db-common
ln -s ../../common/COMMON.md COMMON.md
```

**ä¼˜åŠ¿**ï¼š
- âœ… å•ä¸€æ•°æ®æºï¼Œæ˜“äºç»´æŠ¤
- âœ… ä¿æŒ Skills è‡ªåŒ…å«
- âœ… ç¬¦åˆå®˜æ–¹æœ€ä½³å®è·µ

## å››ã€Agents è®¾è®¡

### 4.1 Agents åˆ—è¡¨

| Agent | æ¥æº | ä½¿ç”¨çš„ Skills | ä¸»è¦åŠŸèƒ½ |
|-------|------|--------------|---------|
| workflow-troubleshooter | op-workflow | db-common | å·¥ä½œæµæ’æŸ¥å’Œè¯Šæ–­ |
| connector-registrar | op-connector | db-common, db-openapi, db-user | è¿æ¥å™¨é…ç½® SQL ç”Ÿæˆ |
| platform-analyst | op-statistics | db-common, db-metadata, db-e-report, db-user, db-openapi | å¹³å°æ•°æ®ç»Ÿè®¡åˆ†æ |
| button-configurator | op-button | db-common, db-metadata | æŒ‰é’®é…ç½® SQL ç”Ÿæˆ |
| event-configurator | op-event | db-common, db-metadata | äº‹ä»¶é…ç½® JSON/SQL ç”Ÿæˆ |

### 4.2 Agent æ ‡å‡†ç»“æ„

```yaml
---
name: workflow-troubleshooter
description: ...
model: sonnet
color: blue
---

# Agent åç§°

## ã€ç›¸å…³ Skillsã€‘

æ‰§è¡Œä»»åŠ¡æ—¶ï¼ŒClaude ä¼šè‡ªåŠ¨å‘ç°å¹¶ä½¿ç”¨ä»¥ä¸‹ Skillsï¼š

- **db-common**: æä¾›æ•°æ®åº“æŸ¥è¯¢å·¥ä½œæµç¨‹...

## ã€æ ¸å¿ƒèŒè´£ã€‘
...

## ã€å·¥ä½œæµç¨‹ã€‘
...
```

### 4.3 Agent è®¾è®¡è¦ç‚¹

**âœ… åº”è¯¥åšçš„**ï¼š
1. åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ç›¸å…³ Skills
2. ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å’Œä»»åŠ¡ç¼–æ’
3. æä¾›æ¸…æ™°çš„å·¥ä½œæµç¨‹
4. æ˜ç¡®èŒè´£è¾¹ç•Œå’Œé™åˆ¶

**âŒ ä¸åº”è¯¥åšçš„**ï¼š
1. åœ¨ frontmatter ä¸­ä½¿ç”¨ `skills` å­—æ®µï¼ˆä¸å­˜åœ¨ï¼‰
2. é‡å¤ Skills ä¸­çš„æŸ¥è¯¢æ¨¡æ¿
3. åŒ…å«å…·ä½“çš„ SQL è¯­å¥ï¼ˆåº”è¯¥åœ¨ Skills ä¸­ï¼‰
4. æ˜¾å¼è°ƒç”¨ Skillsï¼ˆClaude ä¼šè‡ªåŠ¨å‘ç°ï¼‰

## äº”ã€ä¸ op-plugin çš„æ”¹è¿›å¯¹æ¯”

### 5.1 æ¶æ„æ”¹è¿›

| æ–¹é¢ | op-plugin | blacklake_plugin |
|------|-----------|------------------|
| COMMON.md | æ¯ä¸ªç›®å½•ç‹¬ç«‹ | ç»Ÿä¸€ç®¡ç†ï¼Œç¬¦å·é“¾æ¥ |
| Agent èŒè´£ | åŒ…å«æŸ¥è¯¢æ¨¡æ¿ | åªåŒ…å«ä¸šåŠ¡é€»è¾‘ |
| Skills èŒè´£ | åªæœ‰æŸ¥è¯¢æ¨¡æ¿ | åŒ…å«å·¥ä½œæµç¨‹å’Œæ¨¡æ¿ |
| Skills è¯´æ˜ | ç¼ºå°‘ | Agent æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ |

### 5.2 å†…å®¹é‡ç»„

| å†…å®¹ | op-plugin ä½ç½® | blacklake_plugin ä½ç½® |
|------|---------------|---------------------|
| é€šç”¨è§„èŒƒ | æ¯ä¸ª Agent | common/COMMON.md |
| SQL æŸ¥è¯¢æ¨¡æ¿ | Agent ä¸­ | db-common skill |
| å¯¹è±¡æ˜ å°„è¡¨ | op-button.md | db-metadata skill |
| äº‹ä»¶æŸ¥è¯¢æ¨¡æ¿ | op-event.md | db-metadata skill |
| å·¥ä½œæµç¨‹ | ç¼ºå¤± | Skills ä¸­ |

### 5.3 å‘½åæ”¹è¿›

| op-plugin | blacklake_plugin |
|-----------|-----------------|
| op-workflow.md | workflow-troubleshooter.md |
| op-connector.md | connector-registrar.md |
| op-statistics.md | platform-analyst.md |
| op-button.md | button-configurator.md |
| op-event.md | event-configurator.md |

## å…­ã€å®æ–½ç»†èŠ‚

### 6.1 ç¬¦å·é“¾æ¥è®¾ç½®

**macOS/Linux**ï¼š
```bash
cd skills/db-common
ln -s ../../common/COMMON.md COMMON.md
```

**Windows**ï¼š
```powershell
cd skills\db-common
New-Item -ItemType SymbolicLink -Path COMMON.md -Target ..\..\common\COMMON.md
```

### 6.2 éªŒè¯æ–¹æ³•

1. æ£€æŸ¥ç¬¦å·é“¾æ¥æ˜¯å¦æ­£ç¡®ï¼š
   ```bash
   ls -la skills/db-common/COMMON.md
   # åº”è¯¥æ˜¾ç¤ºæŒ‡å‘ ../../common/COMMON.md
   ```

2. éªŒè¯ Agent æ–‡æ¡£ä¸­çš„ Skills å¼•ç”¨
3. éªŒè¯æ‰€æœ‰æ–‡ä»¶è·¯å¾„æ­£ç¡®

## ä¸ƒã€æœ€ä½³å®è·µæ€»ç»“

### 7.1 Skills è®¾è®¡

- âœ… æä¾›ç¨‹åºæ€§çŸ¥è¯†ï¼ˆå¦‚ä½•åšï¼‰
- âœ… åŒ…å«å·¥ä½œæµç¨‹ã€æ¨¡æ¿ã€æœ€ä½³å®è·µ
- âœ… è‡ªåŒ…å«ï¼Œå¯ç‹¬ç«‹ä½¿ç”¨
- âœ… è‡ªåŠ¨å‘ç°ï¼ŒåŠ¨æ€åŠ è½½

### 7.2 Agents è®¾è®¡

- âœ… ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å’Œä»»åŠ¡ç¼–æ’
- âœ… åœ¨æ–‡æ¡£ä¸­è¯´æ˜ç›¸å…³ Skills
- âœ… ä¸é‡å¤ Skills çš„å†…å®¹
- âœ… é€šè¿‡æ–‡æ¡£å¼•å¯¼ä½¿ç”¨ Skills

### 7.3 åä½œæ–¹å¼

- âœ… Claude è‡ªåŠ¨å‘ç° Skills
- âœ… Agent æ–‡æ¡£å¼•å¯¼ä½¿ç”¨
- âœ… ä¸éœ€è¦æ˜¾å¼é…ç½®
- âœ… ä¿æŒä½è€¦åˆ

## å…«ã€å‚è€ƒèµ„æº

- [Claude Code Skills å®˜æ–¹æ–‡æ¡£](https://claude.com/blog/skills-explained)
- [Claude Code æœ€ä½³å®è·µ](https://claude.com/blog/building-skills-for-claude-code)
- [op-plugin é—®é¢˜åˆ†ææ–‡æ¡£](../op-plugin/ISSUES.md)
- [ç‰ˆæœ¬ç®¡ç†è¯´æ˜](../../VERSION_MANAGEMENT.md)

