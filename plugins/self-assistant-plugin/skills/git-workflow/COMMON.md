# Git 操作通用规范

## 【通用原则】

### 1. 安全第一

- **始终创建备份**：在执行任何修改历史的操作前创建备份分支
- **验证后执行**：分析完成后等待用户确认再执行
- **提供回滚方案**：每次操作后提供完整的回滚指令
- **检测远程状态**：如已推送到远程，警告 force push 风险

### 2. 用户体验

- **进度通知**：每个耗时操作（>2秒）开始前输出进度文本
- **清晰反馈**：使用 emoji 和简短文字说明当前状态
- **结果确认**：操作完成后输出明确的成功/失败提示
- **避免冗余**：不输出工具内部详细日志，只输出有意义的信息

### 3. 规范遵循

- **Conventional Commits**：所有提交消息遵循 Conventional Commits 规范
- **格式一致**：`<type>(<scope>): <subject>`
- **语言统一**：根据项目习惯使用中文或英文
- **简洁明了**：subject 不超过 50 字符，祈使语气，无句号

## 【Conventional Commits 规范】

### Type 类型

| Type | 说明 | 示例 |
|------|------|------|
| `feat` | 新功能 | `feat(auth): 添加用户登录功能` |
| `fix` | Bug 修复 | `fix(api): 修复用户信息接口返回错误` |
| `docs` | 文档更新 | `docs(readme): 更新安装说明` |
| `style` | 代码格式 | `style: 统一缩进为2空格` |
| `refactor` | 重构 | `refactor(utils): 优化日期处理函数` |
| `perf` | 性能优化 | `perf(image): 启用图片懒加载` |
| `test` | 测试相关 | `test(user): 添加用户模块单元测试` |
| `build` | 构建系统或依赖 | `build(npm): 升级 webpack 到 5.0` |
| `ci` | CI 配置 | `ci(github): 添加自动部署流程` |
| `chore` | 其他更改 | `chore(deps): 更新依赖版本` |
| `revert` | 回滚提交 | `revert: 回滚 feat(auth) 登录功能` |

### Type 推断规则

从 git diff 分析推断：

- **新增文件/功能** → `feat`
- **关键词**（fix/bug/修复/issue）→ `fix`
- **重构/重命名** → `refactor`
- **文档**（.md/README）→ `docs`
- **测试文件** → `test`
- **依赖**（package.json/pom.xml）→ `build`
- **CI 配置**（.github/.gitlab-ci）→ `ci`
- **子模块**（.gitmodules）→ `chore(submodule)`
- **配置/工具** → `chore`
- **性能相关** → `perf`

### Scope 推断规则

从文件路径提取模块名：

- `src/api/*` → `api`
- `src/ui/*` 或 `components/*` → `ui`
- `plugins/*` → `plugin`
- `*.gitmodules` 或 `submodule` → `submodule`
- `config/*` → `config`
- `docs/*` → `docs`
- 根目录配置 → 省略 scope

### Subject 编写规则

- **祈使语气**：使用动词原形（添加、修复、更新）
- **首字母小写**：英文 subject 首字母小写
- **长度限制**：不超过 50 字符
- **无句号**：结尾不加句号
- **语言选择**：
  - 中文项目优先使用中文
  - 英文项目使用英文
  - 保持项目内一致性

## 【输出格式规范】

### 分析报告格式

使用结构化格式，包含：
- 标题（使用 emoji）
- 统计信息（使用树形结构）
- 分隔线（使用 `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`）
- 详细列表
- 操作建议

示例：

```
📊 提交分析报告

总计：30 个提交
├─ 重复提交：7 个（将合并为 2 个）
├─ 不规范提交：15 个（需改写）
└─ 已规范提交：8 个（无需处理）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

详细信息：
...
```

### 完成报告格式

```
✅ 操作完成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

统计信息：
- 项目1：值1
- 项目2：值2

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

备份信息：
- 备份分支：...
- 回滚命令：...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

下一步操作：
- 操作1：...
- 操作2：...
```

### 错误提示格式

```
❌ 错误标题

错误详情：
- 详情1
- 详情2

可能原因：
- 原因1
- 原因2

建议操作：
1. 步骤1
2. 步骤2
```

### 警告提示格式

```
⚠️ 警告标题

警告内容：
...

风险提示：
- 风险1
- 风险2

是否继续？
```

## 【进度通知规范】

### Emoji 使用规范

| Emoji | 含义 | 使用场景 |
|-------|------|---------|
| 🔍 | 检查/分析 | 开始分析、检查状态 |
| 📊 | 统计/报告 | 输出统计信息、分析报告 |
| 💾 | 保存/备份 | 创建备份、保存文件 |
| 🔄 | 处理中 | 正在执行操作 |
| ✍️ | 编辑/修改 | 修改文件、改写提交 |
| ✅ | 成功 | 操作成功完成 |
| ❌ | 失败 | 操作失败 |
| ⚠️ | 警告 | 需要注意的情况 |
| 🤖 | 自动生成 | AI 生成内容 |
| 📚 | 学习/分析 | 学习项目风格 |

### 进度文本模板

**开始操作**：
```
{emoji} 正在{操作}...
```

**完成操作**：
```
{emoji} {操作}完成！{结果描述}
```

**操作失败**：
```
❌ {操作}失败

错误信息：{错误}
```

## 【用户交互规范】

### 确认机制

对于重要操作（修改历史、删除数据等），必须：

1. **展示操作计划**：详细说明将要执行的操作
2. **提示风险**：明确说明操作的风险和影响
3. **等待确认**：使用 AskQuestion 工具等待用户确认
4. **提供选项**：
   - 确认执行
   - 取消操作
   - （可选）查看更多信息

### 确认对话示例

```
📊 操作计划：

将要执行：
- 操作1
- 操作2

⚠️ 警告：此操作将{风险描述}！

备份信息：
- 备份分支：{备份名称}

请确认是否执行？
```

## 【错误处理规范】

### 错误分类

1. **用户输入错误**：参数格式错误、缺少必需参数
2. **状态检查错误**：暂存区为空、分支状态异常
3. **执行失败错误**：Git 命令失败、权限问题
4. **冲突错误**：Rebase 冲突、合并冲突

### 错误处理流程

1. **检测错误**：在执行前检查前置条件
2. **明确提示**：清晰说明错误原因
3. **提供方案**：给出具体的解决步骤
4. **保护数据**：确保错误不会导致数据丢失

### 错误恢复

- **提供回滚命令**：每次操作后提供回滚方法
- **保留备份**：重要操作前创建备份
- **验证结果**：操作后验证结果正确性

## 【最佳实践】

### Git 操作

1. **检查状态**：操作前检查 git status
2. **创建备份**：修改历史前创建备份分支
3. **验证结果**：操作后验证提交历史
4. **提供指令**：给出完整的 Git 命令供参考

### 提交消息

1. **保持简洁**：subject 简明扼要
2. **语义清晰**：准确描述变更内容
3. **格式统一**：遵循项目规范
4. **避免冗余**：不重复显而易见的信息

### 用户体验

1. **及时反馈**：操作开始前告知用户
2. **清晰说明**：使用简单易懂的语言
3. **提供帮助**：遇到问题时给出解决方案
4. **尊重选择**：等待用户确认重要操作
